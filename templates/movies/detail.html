{% extends "base.html" %}
{% block title %}{{ movie.title }}{% endblock %}
{% block content %}
<div class="row">
  <div class="col-md-4">
    <img src="{{ movie.poster_url }}" class="poster" alt="{{ movie.title }}">
    <div class="mt-3">
      {% if user.is_authenticated %}
        <form action="{% url 'movies:rate' movie.tmdb_id %}" method="post">
          {% csrf_token %}
          <label class="form-label">Your rating</label>
          <select class="form-select" name="rating">
            {% for i in "12345" %}
              <option value="{{ forloop.counter }}" {% if user_rating and user_rating.rating == forloop.counter %}selected{% endif %}>{{ forloop.counter }}</option>
            {% endfor %}
          </select>
          <button class="btn btn-primary btn-sm mt-2">Save Rating</button>
        </form>
        <a href="{% url 'movies:watchlist' movie.tmdb_id %}" class="btn btn-outline-secondary btn-sm mt-2">Toggle Watchlist</a>
      {% else %}
        <p class="text-muted">Login to rate or add to watchlist.</p>
      {% endif %}
    </div>
  </div>
  <div class="col-md-8">
    <h2>{{ movie.title }}</h2>
    <p class="text-muted">Release: {{ movie.release_date }} | Avg: {{ movie.vote_average }} ({{ movie.vote_count }} votes)</p>
    <p>{{ movie.overview }}</p>
    <p>Genres:
      {% for g in movie.genres.all %}
        <span class="badge text-bg-secondary">{{ g.name }}</span>
      {% empty %}<span class="text-muted">N/A</span>{% endfor %}
    </p>
    <!-- <a class="btn btn-success" href="/recs/?seed={{ movie.id }}">Get similar recommendations with explanations</a> -->
    <a href="{% url 'recs:list' %}?seed={{ movie.id }}" class="btn btn-outline-primary">
      Recommend similar to this
    </a>
  </div>
</div>
{% endblock %}